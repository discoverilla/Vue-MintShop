# 项目开发流程

## 1. 创建客户端项目

###  1.1 使用 vue-cli(脚手架)搭建项目 

```bash
#在Github新建Vue-MintShop项目,然后clone到本地
git clone git@github.com:W-Qing/Vue-MintShop.git
cd Vue-MintShop
#创建客户端项目
vue init webpack mintshop-client
cd mintshop-client
npm install
npm run dev 访问: localhost:8080
```

### 1.2 项目结构分析 

>  **MintShop-client **
>
>  - |-- build : webpack 相关的配置文件夹(基本不需要修改) 
>  - |-- build : webpack 相关的配置文件夹(基本不需要修改) 
>  - |-- config: webpack 相关的配置文件夹(基本不需要修改)
>  - |-- index.js: 指定的后台服务的端口号和静态资源文件夹 
>  - |-- node_modules 
>  - |-- src : 源码文件夹 
>  - |-- main.js: 应用入口 js  （初始化vue实例并使用需要的插件 ）
>  - |-- static: 静态资源文件夹
>  - |-- .babelrc: babel 的配置文件
>  - |-- .editorconfig: 通过编辑器的编码/格式进行一定的配置
>  - |-- .eslintignore: eslint 检查忽略的配置
>  -  |-- .eslintrc.js: eslint 检查的配置 
>  - |-- .gitignore: git 版本管理忽略的配置 
>  - |-- index.html: 默认的主渲染页面文件 
>  - |-- package.json: 应用包配置文件
>  - |-- README.md: 应用描述说明的 readme 文件 

### 1.3 编码测试与打包发布项目  

- 编码测试 

  npm run dev 

  访问: http://localhost:8080 

  编码, 自动编译打包(HMR), 查看效果 

- 打包发布 

  npm run build 

  npm install -g serve 

  serve dist

  访问: http://localhost:5000  

## 2. 功能需求分析（todo）

## 3. 开发资源准备
- 使用[阿里巴巴矢量库]( http://www.iconfont.cn/)
- 将想要的图标添加入库（购物车） 
- 将购物车中的图标添加到项目中 
- 生成项目图标的[Font Class地址](//at.alicdn.com/t/font_726904_rwoi76wohhq.css)

## 4. Css Reset、Fastclick与Stylus

### 4.1 Css Reset

- 在项目主目录下的static文件夹内新建css文件夹

- 在css文件夹内新建重置样式文件reset.css 

- 在index.html 中引入 

  ```html
  <link rel="stylesheet" href="/static/css/reset.css">
  ```

### 4.2 Fastclick

> 当用户一次点击屏幕之后，浏览器并不能立刻判断用户是要进行双击缩放，还是想要进行单击操作。因此，iOS Safari 就等待 300 毫秒，以判断用户是否再次点击了屏幕。 于是，300 毫秒延迟就这么诞生了。

- 安装fastclick库  解决点击响应延时 0.3s 问题 

  ```bash
  npm Install fastclick --save
  ```

- 在main.js中引入，并绑定到body

  ```js
  import FastClick from 'fastclick'
  FastClick.attach(document.body);
  ```

### 4.3 Stylus

- 安装stylus依赖包

  ```bash
  npm install stylus stylus-loader --save-dev
  ```

- 在common文件夹下新建stylus文件夹

- 在stylus文件加下面新建mixins.styl文件

- 注意在组件内编写样式时要声明lang和rel

  ```html
  <style lang="stylus" rel="stylesheet/stylus">
  ```

## 5. 源码目录设计

![src目录结构](http://owoccema2.bkt.clouddn.com/Readme/vue/mintshop.png)

## 6. Vue组件化

### 6.1 分析整个项目的 vue 组件结构 

> **src**
> - |-- components------------非路由组件文件夹 
> - |-- FooterGuide---------------底部组件文件夹 
>   - |-- FooterGuide.vue--------底部组件 vue 
> - |-- pages-----------------路由组件文件夹 
>   - |-- Msite---------------首页组件文件夹 
>     - |-- Msite.vue--------首页组件 vue
>   - |-- Search----------------搜索组件文件夹 
>     - |-- Search.vue---------搜索组件 vue 
>   - |-- Order--------------订单组件文件夹
>     - |-- Order.vue-------订单组件 vue
>   - |-- Profile--------------个人组件文件夹 
>     - |-- Profile.vue-------个人组件 vue 
> - |-- App.vue---------------应用根组件 vue 
> - |-- main.js---------------应用入口 js 

1. 页面底部的FooterGuide组件只是用来放pages里的组件的容器，所以它不是路由组件
2. 页面最上面的标题栏在我们的项目中属于路由组件的组成部分（与中间内容部分在一起）
3. 但每个路由组件中都有最顶部的组件且相似度很高，所以可以将其抽取成为一个单独的组件

### 6.2 编写vue组件模板文件

- pages文件夹下的各个vue组件文件及App.vue和FooterGuide.vue都是这个初始空白模板

```vue
<template>
  <div>App vue template</div>
</template>

<script>
  export default {}
</script>

<style lang="stylus" rel="stylesheet/stylus">
</style>
```

## 7. 引入Vue-router

###7.1 下载vue-router 

   ```bash
#创建项目时已下载
npm install vue-router --save
   ```

### 7.2 编写router文件夹下的index.js

```javascript
 /*
   路由模块 
 */
 import Vue from 'vue'
 import VueRouter from 'vue-router'
 // 引入路由组件文件夹下的组件
 import Msite from '../pages/Msite/Msite.vue'
 import Search from '../pages/Search/Search.vue'
 import Order from '../pages/Order/Order.vue'
 import Profile from '../pages/Profile/Profile.vue'
 // 全局注册Vue-router组件
 Vue.use(VueRouter)
 
 // 配置路由表并导出
 export default new VueRouter({
   //去掉地址中的哈希#
   mode: 'history',
   routes: [{
       path: '/',
       redirect: '/msite'
     },
     {
       path: '/msite',
       component: Msite,
     },
     {
       path: '/search',
       component: Search,
     },
     {
       path: '/order',
       component: Order,
     },
     {
       path: '/profile',
       component: Profile,
     }
   ]
 })
```

### 7.3 编写应用的入口文件main.js

```javascript
// 引入路由 其实就是引入上一步配置好的路由表
import router from './router'

new Vue({
  el: '#app',
  render: h => h(app),
  // 为根组件加入路由
  router
})
```

### 7.4 在App.vue里使用router-view

```vue
<template>
  <!-- 修改应用组件的模板 -->
  <div id="app">
    <!-- 设置路由组件的视图位置 -->
    <router-view></router-view>
    <!-- 并放置非路由组件 -->
    <FooterGuide></FooterGuide>
  </div>
</template>

<script>
import FooterGuide from './components/FooterGuide/FooterGuide.vue'
// 引入底部组件并注册
export default {
  components: {
    FooterGuide
  }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
// 整个应用组件的样式
  #app
    width 100%
    height 100%
    background #f5f5f5
</style>
```

- App.vue里的根元素`<div id="app"></div>`与外层被注入框架index.html中的`<div id="app"></div>`是一致的 
- index.html中的`<div id="app"></div>`是指定绑定目标为元素的根路径，而App.vue文件里的`<div id="app"></div>`则是提供注入绑定元素的内容，两者在运行时指的是同一个DOM元素 

### 7.5 运行并请求不同路由路径查看效果

通过切换url地址里的hash值（miste/order/search/profile），页面会显示不同的路由模板内容。

## 8. 编写组件代码

### 8.1 FooterGuide组件

**功能及实现**

1. 通过编程式导航实现路由的切换显示($router) 
2. 通过动态 class 和$route.path 来实现 tab 样式切换 
3. 通过阿里图标库, 显示导航图标 

**代码**

```html
<footer class="footer_guide border-1px">
    <a href="javascript:;" class="guide_item on">
    <span class="item_icon">
    <i class="iconfont icon-food"></i>
    </span>
    <span>外卖</span>
    </a>
    <!--其他三部分类似-->
</footer>
```

```css
<style lang="stylus" rel="stylesheet/stylus">
/*引入公共样式*/
@import "../../common/stylus/mixins.styl"
.footer_guide
  /*顶部有白色的边框*/
  top-border-1px(#e4e4e4)
  position fixed
  z-index 100
  left 0
  right 0
  bottom 0
  background-color #fff
  width 100%
  height 50px
  display flex
  .guide_item
    display flex
    flex 1
    text-align center
    flex-direction column
    align-items center
    margin 5px
    color #999999
    &.on
      color #02a774
    span
      font-size 12px
      margin-top 2px
      margin-bottom 2px
      .iconfont
        font-size 22px
</style>
```

此时，页面已达到理想效果。接着修改template模板，为其加入路由与样式的切换控制。

```html
<div class="guide_item" @click="goto('/msite')" :class="{on: isCurrent('/msite')}">
  <span class="item_icon">
  <i class="iconfont icon-food"></i>
  </span>
  <span>首页</span>
</div>
<!--其他三个部分类似，只是路由不同-->
```

再补充相应的函数方法

```javascript
export default {
  methods: {
    goto (path) {
      this.$router.replace(path)
    },
    isCurrent (path) {
      // console.log(this.$route.path)
      return this.$route.path === path
    }
  }
}
```

至此，底部组件完成，可实现点击不同的选项切换不同的路由组件。

### 8.2 各导航路由组件

#### 8.2.1 Msite组件

**功能区域划分**

1. 最顶部的title标题栏部分
2. 上方的nav轮播区域
3. 商家列表展示区域

**图片资源**

Msite组件页面的轮播图及商家列表都需要用到一些图片资源文件，所以在msite.vue同级目录下新建images文件夹，以便放置各种不同类型的图片资源。

**代码**

```vue
<template>
  <section class="msite">
    <!--首页头部title-->
    <!--由msite_header改成header-->
    <header class="header">
      <span class="header_search">
        <i class="iconfont icon-sousuo"></i>
      </span>
      <span class="header_title">
        <span class="header_title_text ellipsis">芝罘区鲁东大学北区(青年南路)</span>
      </span>
      <span class="header_login">
        <span class="header_login_text">登录|注册</span>
      </span>
    </header>
    <!--首页导航轮播-->
    <nav class="msite_nav">
      <div class="swiper-container">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <a href="javascript:" class="link_to_food">
              <div class="food_container">
                <img src="./images/nav/1.jpg">
              </div>
              <span>甜品饮品</span>
            </a>
            <a href="javascript:" class="link_to_food">
              <div class="food_container">
                <img src="./images/nav/2.jpg">
              </div>
              <span>商超便利</span>
            </a>
           <!--下面的图片省略-->
          </div>
          <div class="swiper-slide">
            <a href="javascript:" class="link_to_food">
              <div class="food_container">
                <img src="./images/nav/9.jpg">
              </div>
              <span>甜品饮品</span>
            </a>
            <!--同样省略-->
          </div>
        </div>
        <!-- 轮播图页码 -->
        <div class="swiper-pagination"></div>
      </div>
    </nav>
    <!--首页附近商家列表-->
    <div class="msite_shop_list">
      <div class="shop_header">
        <i class="iconfont icon-xuanxiang"></i>
        <span class="shop_header_title">附近商家</span>
      </div>
      <div class="shop_container">
        <ul class="shop_list">
          <li class="shop_li border-1px">
            <a>
              <div class="shop_left">
                <img class="shop_img" src="./images/shop/1.jpg">
              </div>
              <div class="shop_right">
                <section class="shop_detail_header">
                  <h4 class="shop_title ellipsis">锄禾日当午，汗滴禾下土</h4>
                  <ul class="shop_detail_ul">
                    <li class="supports">保</li>
                    <li class="supports">准</li>
                    <li class="supports">票</li>
                  </ul>
                </section>
                <section class="shop_rating_order">
                  <section class="shop_rating_order_left">
                    <div class="star star-24">
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item half"></span>
                      <span class="star-item off"></span>
                    </div>
                    <div class="rating_section">
                      3.6
                    </div>
                    <div class="order_section">
                      月售106单
                    </div>
                  </section>
                  <section class="shop_rating_order_right">
                    <span class="delivery_style delivery_right">硅谷专送</span>
                  </section>
                </section>
                <section class="shop_distance">
                  <p class="shop_delivery_msg">
                    <span>¥20起送</span>
                    <span class="segmentation">/</span>
                    <span>配送费约¥5</span>
                  </p>
                </section>
              </div>
            </a>
          </li>
          <!--省略其他店铺展示-->
        </ul>
      </div>
    </div>
  </section>
</template>
<!--省略js-->
```

**要注意首页的头部标题部分的样式，在其他的组件中都可以进行重用。**所以将header标签的类名由msite_header改成header。接下来在其他组件中可以直接使用（当然header里的部分样式其他组件用不到，到时再进一步抽取公共的css样式。）

```css
<style lang="stylus" rel="stylesheet/stylus">
  @import "../../common/stylus/mixins.styl"
  .msite  //首页
    width 100%
    .header
      background-color #02a774
      position fixed
      z-index 100
      left 0
      top 0
      width 100%
      height 45px
      .header_search
        position absolute
        left 15px
        top 50%
        transform translateY(-50%)
        width 10%
        height 50%
        .icon-sousuo
          font-size 25px
          color #fff
      .header_title
        position absolute
        top 50%
        left 50%
        transform translate(-50%, -50%)
        width 50%
        color #fff
        text-align center
        .header_title_text
          font-size 20px
          color #fff
          display block
      .header_login
        font-size 14px
        color #fff
        position absolute
        right 15px
        top 50%
        transform translateY(-50%)
        .header_login_text
          color #fff
      /*下面的样式省略*/
</style>
```

接下来的几个路由组件都类似，都是先修改template模版，然后引入mixins.styl 样式文件和上面提到的公共的header部分的样式。

#### 8.2.2 Search组件

```vue
<section class="search">
    <header class="header">
      <div class="header_title">
        <span class="header_title_text">搜索</span>
      </div>
    </header>
    <form class="search_form" action="#">
      <input type="search" name="search" placeholder="请输入商家或美食名称"
    class="search_input">
      <input type="submit" class="search_submit">
    </form>
</section>
<!--省略js与style-->
```

#### 8.2.3 Order组件

在order.vue同级目录下新建images文件夹，再新建order文件夹，存放订单组件用到的图片资源。

```vue
<div>
  <section class="order">
    <header class="header">
      <a class="header_title">
        <span class="header_title_text">订单列表</span>
      </a>
    </header>
    <section class="order_no_login">
        <img src="./images/order/person.png">
        <h3>登录后查看外卖订单</h3>
      <button>立即登陆</button>
    </section>
  </section>
</div>
<!--省略js与style-->
```

#### 8.2.4 Profile组件

```vue
<div>
    <section class="profile">
      <header class="header">
        <a class="header_title">
          <span class="header_title_text">我的</span>
        </a>
      </header>
      <section class="profile-number">
        <a href="javascript:" class="profile-link">
          <div class="profile_image">
            <i class="iconfont icon-yonghuming"></i>
          </div>
          <div class="user-info">
            <p class="user-info-top">登录/注册</p>
            <p>
              <span class="user-icon">
                <i class="iconfont icon-msnui-tel icon-mobile"></i>
              </span>
              <span class="icon-mobile-number">暂无绑定手机号</span>
            </p>
          </div>
          <span class="arrow">
            <i class="iconfont icon-previewright"></i>
          </span>
        </a>
      </section>
      <section class="profile_info_data border-1px">
        <ul class="info_data_list">
          <a href="javascript:" class="info_data_link">
            <span class="info_data_top"><span>0.00</span>元</span>
            <span class="info_data_bottom">我的余额</span>
          </a>
          <a href="javascript:" class="info_data_link">
            <span class="info_data_top"><span>0</span>个</span>
            <span class="info_data_bottom">我的优惠</span>
          </a>
          <a href="javascript:" class="info_data_link">
            <span class="info_data_top"><span>0</span>分</span>
            <span class="info_data_bottom">我的积分</span>
          </a>
        </ul>
      </section>
      <section class="profile_my_order border-1px">
        <!-- 我的订单 -->
        <a href='javascript:' class="my_order">
          <span>
            <i class="iconfont icon-dingdan"></i>
          </span>
          <div class="my_order_div">
            <span>我的订单</span>
            <span class="my_order_icon">
              <i class="iconfont icon-previewright"></i>
            </span>
          </div>
        </a>
        <!-- 积分商城 -->
        <a href='javascript:' class="my_order">
          <span>
            <i class="iconfont icon-jifen"></i>
          </span>
          <div class="my_order_div">
            <span>积分商城</span>
            <span class="my_order_icon">
              <i class="iconfont icon-previewright"></i>
            </span>
          </div>
        </a>
        <!-- Mint外卖会员卡 -->
        <a href="javascript:" class="my_order">
          <span>
            <i class="iconfont icon-viptehuishiduan"></i>
          </span>
          <div class="my_order_div">
            <span>Mint外卖会员卡</span>
            <span class="my_order_icon">
              <i class="iconfont icon-previewright"></i>
            </span>
          </div>
        </a>
      </section>
      <section class="profile_my_order border-1px">
        <!-- 服务中心 -->
        <a href="javascript:" class="my_order">
          <span>
            <i class="iconfont icon-lianxikefu"></i>
          </span>
          <div class="my_order_div">
            <span>服务中心</span>
            <span class="my_order_icon">
              <i class="iconfont icon-previewright"></i>
            </span>
          </div>
        </a>
      </section>
    </section>
  </div>
<!--省略js与style-->
```